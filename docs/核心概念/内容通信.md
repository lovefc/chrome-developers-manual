# 脚本消息通信



因为内容脚本作为插入网页的js，所以不具备访问api的一些权限，但如果我们要获取网页的内容，并且跟api交互，这时候该怎么做呢，这时候就需要消息通信了，我们可以利用chrome.runtime.sendMessage这个api，把内容脚本的信息传递到background(背景),popup(弹出页)进行处理。

首先在content.js中主动发消息：

```js
chrome.runtime.sendMessage({text: '你好，我是content-script呀，我主动发消息给后台！'}, function(response) {
    console.log('收到的回复：' + response);
});
```

background.js或者popup.js中都能接受这条消息，但是你要写代码监听消息：

```js
// 监听消息
chrome.runtime.onMessage.addListener(function(request, sender, sendResponse)
{
    console.log('收到来自content-script的消息：');
    console.log(request, sender, sendResponse);
	//做出回应
    sendResponse('popup已收到你的消息'); 
});
```

配置清单这样定义：

```json
  "action": {
    // 默认弹出
    "default_popup": "hello.html",	  
    // 默认图标
    "default_icon": "images/icon.png"
  },
  "content_scripts": [
    {
      "matches": ["https://www.baidu.com/*"],
      "js": ["content.js"]
    }
  ], 
  "background": {
    "service_worker": "background.js"
  },
```

这里只有访问百度，才会触发自动发信息给background或者popup。




